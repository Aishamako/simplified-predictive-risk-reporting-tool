<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cybersecurity Threat Classifier</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <h1>ğŸ›¡ï¸ Simplified Predictive Risk Reporting Tool</h1>
        <p>Powered by AI & Real-Time Threat Intelligence</p>
    </header>
    
    <p style="text-align:right;">
        Logged in as {{ session['user'] }} | <a href="/logout">Logout</a>
    </p>
    
    <!-- ğŸ” Threat Description Input -->
    <form method="POST" action="/">
        <label for="text">Enter threat description:</label><br><br>
        <textarea name="text" rows="5" placeholder="e.g. Hackers used SQL Injection on Apache servers"></textarea><br><br>

        <label for="chart_type">Choose chart type:</label>
        <select name="chart_type" id="chart_type">
            <option value="bar">Bar Chart</option>
            <option value="pie">Pie Chart</option>
        </select><br><br>

        <input type="submit" value="Analyze">
    </form>

    <!-- ğŸ§  NLP Entity Output -->
    {% if entities %}
        <h2 style="text-align:center;">ğŸ§  Predicted Entities:</h2>
        <div class="entity-container">
            {% for ent, label in entities %}
                <div class="entity-card {{ label }}">
                    <span class="label-icon">ğŸ”–</span>
                    <strong>{{ ent }}</strong>
                    <span class="entity-type">{{ label }}</span>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- ğŸ“Š Chart Output -->
    {% if chart %}
        <div class="chart-container">
            <h2>ğŸ“Š Risk Report Summary</h2>
            <img src="{{ url_for('static', filename='chart.png') }}" alt="Entity Chart">
            <a href="/export" class="export-button">â¬‡ï¸ Export as .txt</a>
            <a href="/export/pdf" class="export-button">ğŸ“„ Export as PDF</a>
        </div>
    {% endif %}

    <!-- ğŸŒ VirusTotal Domain Lookup -->
    <hr>
    <h2>ğŸ” Check Domain with VirusTotal</h2>
    <form method="POST" action="/">
        <input type="text" name="domain" placeholder="Enter domain (e.g. example.com)" required>
        <button type="submit" name="vt_submit">Check Threat Status</button>
    </form>

    {% if vt_result %}
        <div style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
            <h3>ğŸ›¡ï¸ VirusTotal Scan Results</h3>
            <p><strong>Domain:</strong> {{ vt_result.domain }}</p>
            <p><strong>Categories:</strong> {{ vt_result.categories }}</p>
            <p><strong>Last Analysis:</strong></p>
            <ul>
                {% for key, value in vt_result.analysis.items() %}
                    <li>{{ key }}: {{ value }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <!-- ğŸ›°ï¸ Shodan IP Lookup -->
    <hr>
    <h2>ğŸŒ IP Exposure Check with Shodan</h2>
    <form method="POST" action="/">
        <input type="text" name="ip" placeholder="Enter IP address (e.g. 8.8.8.8)" required>
        <button type="submit" name="shodan_submit">Run Shodan Lookup</button>
    </form>

    {% if shodan_result %}
        <div class="shodan-result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
            <h3>ğŸ“¡ Shodan Results</h3>
            <p><strong>IP:</strong> {{ shodan_result.ip }}</p>
            <p><strong>Organization:</strong> {{ shodan_result.organization }}</p>
            <p><strong>Operating System:</strong> {{ shodan_result.os or 'N/A' }}</p>
            <p><strong>Ports:</strong> {{ shodan_result.ports | join(', ') }}</p>
            {% if shodan_result.vulns %}
                <p><strong>Vulnerabilities:</strong></p>
                <ul>
                    {% for vuln in shodan_result.vulns %}
                        <li>{{ vuln }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p><strong>Vulnerabilities:</strong> None reported.</p>
            {% endif %}
        </div>
    {% endif %}
</body>
</html>


